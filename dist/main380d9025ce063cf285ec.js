!function(){"use strict";var t={btn:document.querySelector(".panel__add-goods"),table:document.querySelector(".table__body"),modal:document.querySelector(".overlay"),checkbox:document.querySelector(".modal__checkbox"),discont:document.querySelector(".modal__input_discount"),formelems:document.querySelectorAll(".modal__input"),form:document.querySelector(".modal__form"),price:document.querySelector("#price"),count:document.querySelector("#count"),span:document.querySelector(".vendor-code__id"),overlay:document.querySelector(".overlay")};const e=async()=>{const t=await fetch("http://localhost:3000/api/category",{method:"GET"});if(t.ok){const e=await t.json(),n=document.getElementById("categoryId"),a=document.getElementById("category");if(n){const t=document.createElement("datalist");t.id="category-list-id",e.forEach((e=>{const n=document.createElement("option");n.value=e,t.appendChild(n)})),n.appendChild(t)}if(a){const t=document.createElement("datalist");t.id="category-list",e.forEach((e=>{const n=document.createElement("option");n.value=e,t.appendChild(n)})),a.setAttribute("list","category-list"),a.appendChild(t)}}},n=t=>t?(100-t)/100:1,a=(t,e,a)=>t*e*n(a),o=async()=>{const t=document.querySelector(".cms__total-price"),e=await(async()=>(await C()).reduce(((t,{count:e,price:a,discount:o})=>t+a*e*n(o)),0).toFixed(2))();t.textContent=e},c=document.querySelector(".modal__file"),d=document.querySelector(".modal__label_discount"),l=document.createElement("div");l.classList.add("spacer-container"),d.after(l);const s=document.createElement("img");s.classList.add("modal__spacer"),l.appendChild(s);const i=document.createElement("div");i.classList.add("message-container"),l.appendChild(i);const r=document.createElement("p");r.textContent="Изображение не должно превышать размер 1 Мб",r.style.color="red";const m=t=>new Promise(((e,n)=>{const a=new FileReader;a.addEventListener("loadend",(()=>{e(a.result)})),a.addEventListener("loadend",(()=>{n(err)})),a.readAsDataURL(t)}));c.addEventListener("change",(()=>{if(c.files.length>0){const t=c.files[0];if(t.size/1048576>1)i.appendChild(r);else{const e=URL.createObjectURL(t);s.style.display="block",s.src=e}}}));var u={file:c,discountSection:d,spacer:s,spacerContainer:l,message:r,messageContainer:i};const p=(t,e)=>{const n=document.querySelector(`tr[data-id="${t}"]`);if(n){const t=n.querySelector(".table__cell-id"),o=n.querySelector(".table__cell_name"),c=n.querySelector(".table__cell_category"),d=n.querySelector(".table__cell_units"),l=n.querySelector(".table__cell_count"),s=n.querySelector(".table__cell_price"),i=n.querySelector(".table__total");t&&(t.textContent="ID: "+e.id),o&&(o.textContent=e.title),c&&(c.textContent=e.category),d&&(d.textContent=e.units),l&&(l.textContent=e.count),s&&(s.textContent=e.price);const r=a(e.count,e.price,e.discount).toFixed(2);i&&(i.textContent=r)}else console.error(`Row with data-id "${t}" not found`)},{table:_}=t,b=()=>{const t=_.querySelectorAll(".table__cell-num");let e=1;t.forEach((t=>{t.textContent=e++}))},h=({id:t,title:n,price:c,category:d,count:l,units:s,discount:i,description:r})=>{const u=document.createElement("tr");u.classList.add("row"),u.setAttribute("data-id",t);const _=document.createElement("td");_.classList.add("table__cell","table__cell-num");const h=document.createElement("span"),y=document.createElement("td");y.classList.add("table__cell","table__cell_left","table__cell_name"),h.classList.add("table__cell-id"),h.textContent="ID: "+t,y.textContent=n,y.prepend(h);const C=document.createElement("td");C.classList.add("table__cell","table__cell_left"),C.textContent=d;const E=document.createElement("td");E.classList.add("table__cell"),E.textContent=s;const g=document.createElement("td");g.classList.add("table__cell"),g.textContent=l;const L=document.createElement("td");L.classList.add("table__cell"),L.textContent=c;const v=document.createElement("td");v.classList.add("table__cell","table__total");const f=a(l,c,i).toFixed(2);v.textContent=f;const x=document.createElement("td");x.classList.add("table__cell","table__cell_btn-wrapper");const w=document.createElement("button");w.classList.add("table__btn","table__btn_pic");const A=document.createElement("button");A.classList.add("table__btn","table__btn_edit"),A.addEventListener("click",(()=>{(({id:t,title:n,price:c,category:d,count:l,units:s,discount:i,description:r,image:u})=>{e();const _=document.createElement("div");_.classList.add("overlay","active"),_.addEventListener("click",(t=>{t.target===_&&Z()}));const h=document.createElement("div");h.classList.add("overlay__modal","modal");const y=document.createElement("div");y.classList.add("modal_top");const C=document.createElement("h2");C.classList.add("modal__title"),C.textContent="Изменить";const E=document.createElement("div");E.classList.add("modal__vendor-code","vendor-code");const g=document.createElement("p");g.classList.add("vendor-code__wrapper"),g.textContent="id:";const L=document.createElement("span");L.classList.add("vendor-code__id"),L.textContent=t,g.appendChild(L),E.appendChild(g),y.appendChild(C),y.appendChild(E);const v=document.createElement("form");v.classList.add("modal__form");const f=document.createElement("fieldset");f.classList.add("modal__fieldset");const x=document.createElement("label");x.classList.add("modal__label","modal__label_name"),x.setAttribute("for","name");const w=document.createElement("span");w.classList.add("modal__text"),w.textContent="Наименование";const A=document.createElement("input");A.classList.add("modal__input"),A.setAttribute("type","text"),A.setAttribute("name","title"),A.setAttribute("id","name"),A.value=n,x.appendChild(w),x.appendChild(A);const S=document.createElement("label");S.classList.add("modal__label","modal__label_category"),S.setAttribute("for","category");const k=document.createElement("span");k.classList.add("modal__text"),k.textContent="Категория";const q=document.createElement("input");q.classList.add("modal__input"),q.setAttribute("type","text"),q.setAttribute("name","categoryId"),q.setAttribute("id","categoryId"),q.setAttribute("list","category-list-id"),q.value=d,S.appendChild(k),S.appendChild(q);const j=document.createElement("label");j.classList.add("modal__label","modal__label_description"),j.setAttribute("for","description");const T=document.createElement("span");T.classList.add("modal__text"),T.textContent="Описание";const $=document.createElement("textarea");$.classList.add("modal__input","modal__input_textarea"),$.setAttribute("name","description"),$.setAttribute("id","description"),$.value=r,j.appendChild(T),j.appendChild($);const I=document.createElement("label");I.classList.add("modal__label","modal__label_units"),I.setAttribute("for","units");const F=document.createElement("span");F.classList.add("modal__text"),F.textContent="Единицы измерения";const O=document.createElement("input");O.classList.add("modal__input"),O.setAttribute("type","text"),O.setAttribute("name","units"),O.setAttribute("id","units"),O.value=s,I.appendChild(F),I.appendChild(O);const D=document.createElement("div");D.classList.add("modal__label","modal__label_discount_two");const M=document.createElement("label");M.classList.add("modal__text"),M.setAttribute("for","discount"),M.textContent="Дисконт";const R=document.createElement("div");R.classList.add("modal__checkbox-wrapper");const N=document.createElement("input");N.classList.add("modal__checkbox"),N.setAttribute("type","checkbox"),N.setAttribute("name","discount"),N.setAttribute("id","discount"),N.checked=!0,N.addEventListener("change",(()=>{U.disabled=!N.checked,N.checked||(U.value="")}));const U=document.createElement("input");U.classList.add("modal__input","modal__input_discount"),U.setAttribute("type","number"),U.setAttribute("name","discount_count"),U.value=null!=i?String(i):"",D.appendChild(M),R.appendChild(N),R.appendChild(U),D.appendChild(R);const P=document.createElement("label");P.classList.add("modal__label","modal__label_count"),P.setAttribute("for","count");const H=document.createElement("span");H.classList.add("modal__text"),H.textContent="Количество";const J=document.createElement("input");J.classList.add("modal__input"),J.setAttribute("type","number"),J.setAttribute("name","count"),J.setAttribute("id","count"),J.value=l,P.appendChild(H),P.appendChild(J);const z=document.createElement("label");z.classList.add("modal__label","modal__label_price"),z.setAttribute("for","price");const B=document.createElement("span");B.classList.add("modal__text"),B.textContent="Цена";const V=document.createElement("input");V.classList.add("modal__input"),V.setAttribute("type","number"),V.setAttribute("name","price"),V.setAttribute("id","price"),V.value=c,z.appendChild(B),z.appendChild(V);const G=document.createElement("label");G.setAttribute("tabindex","0"),G.setAttribute("for","image2"),G.classList.add("modal__label","modal__label_file"),G.textContent="Добавить изображение";const K=document.createElement("input");K.classList.add("modal__file_two","visually-hidden"),K.setAttribute("type","file"),K.setAttribute("id","image2"),f.appendChild(x),f.appendChild(S),f.appendChild(j),f.appendChild(I),f.appendChild(D),f.appendChild(P),f.appendChild(z),f.appendChild(G),f.appendChild(K);const Q=document.createElement("div");Q.classList.add("modal__footer");const W=document.createElement("label");W.classList.add("modal__total"),W.textContent="Итоговая стоимость: ";const X=document.createElement("output");X.classList.add("modal__total-price"),X.setAttribute("name","total"),X.textContent=`$${a(c,l,i).toFixed(2)}`,W.appendChild(X);const Y=document.createElement("button");Y.classList.add("modal__submit"),Y.setAttribute("type","submit"),Y.textContent="Сохранить изменения";const Z=()=>{_.classList.remove("active")};v.addEventListener("submit",(async e=>{e.preventDefault();const n=new FormData(v),a=Object.fromEntries(n),c={id:t,title:a.title,category:a.category,description:a.description,units:a.units,count:Number(a.count),price:Number(a.price),discount:!!a.discontValue&&Number(a.discontValue),image:K.files[0]?await m(K.files[0]):null};(async(t,e)=>{fetch(`http://localhost:3000/api/goods/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((n=>{n.ok?(console.log("Changes saved successfully"),p(t,e),b()):console.error("Error saving changes:",n.statusText)})).catch((t=>{console.error("Error saving changes:",t)}))})(t,c),Z(),await o()}));const tt=document.createElement("button");tt.classList.add("modal__close"),tt.innerHTML='\n      <svg width="24" height="24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="m2 2 20 20M2 22 22 2" stroke="currentColor" stroke-width="3" stroke-linecap="round" />\n      </svg>\n    ',tt.addEventListener("click",Z),Q.appendChild(W),Q.appendChild(Y),v.appendChild(f),v.appendChild(Q),h.appendChild(tt),h.appendChild(y),h.appendChild(v),_.appendChild(h),document.body.appendChild(_)})({id:t,title:n,price:c,category:d,count:l,units:s,discount:i,description:r,image:image}),(()=>{const t=document.querySelector(".modal__file_two"),e=document.querySelector(".modal__label_discount_two"),n=document.createElement("div");n.classList.add("image-preview-container"),e.after(n);const a=document.createElement("img");a.classList.add("modal_spacer"),n.appendChild(a);const o=document.createElement("div");o.classList.add("mes-container"),n.appendChild(o);const c=document.createElement("p");c.textContent="Изображение не должно превышать размер 1 Мб",c.style.color="red",t.addEventListener("change",(()=>{if(t.files.length>0){console.log(1);const e=t.files[0];if(e.size/1048576>1)o.appendChild(c);else{const t=URL.createObjectURL(e);a.style.display="block",a.src=t}}}))})()}));const S=document.createElement("button");return S.classList.add("table__btn","table__btn_del"),x.append(w,A,S),u.append(_,y,C,E,g,L,v,x),u},{table:y}=t,C=async()=>{const t=await fetch("http://localhost:3000/api/goods");return await t.json()},{modal:E,discont:g,span:L}=t,{file:v,spacer:f,spacerContainer:x,messageContainer:w}=u,A=()=>{v.value="",f.src="",x.style.display="none",w.style.display="none",g.disabled=!0,E.classList.remove("active")},{btn:S,table:k,modal:q,form:j,price:T,count:$,discont:I,formelems:F,checkbox:O}=t,{table:D}=t;let M;const R=document.querySelector(".panel__input");R.addEventListener("input",(()=>{clearTimeout(M),M=setTimeout((()=>{const t=R.value;N(t)}),300)}));const N=async t=>{try{const e=await fetch(`http://localhost:3000/api/goods?search=${encodeURIComponent(t)}`),n=await e.json();D.innerHTML="",n.forEach((t=>{const{id:e,title:n,price:a,category:o,count:c,units:d,discount:l,description:s,image:i}=t,r=h({id:e,title:n,price:a,category:o,count:c,units:d,discount:l,description:s,image:i});D.appendChild(r)})),b()}catch(t){console.error(t)}},{overlay:U}=t;U.classList.remove("active"),O.onclick=function(){O.checked?I.disabled=!1:(I.value="",I.disabled=!0)},j.addEventListener("submit",(async t=>{t.preventDefault();const e=new FormData(t.target),n=Object.fromEntries(e);n.image=await m(n.image),n.id=document.querySelector(".vendor-code__id").textContent,n.discont=document.querySelector(".modal__input_discount").value,(async t=>{try{const e=await fetch("http://localhost:3000/api/goods",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(e.ok){const n=await e.json();console.log(n),(async(t,e)=>{try{const n=await fetch("http://localhost:3000/api/goods",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(n.ok){const t=await n.json(),a=h(t);e.appendChild(a),b(),await o()}else console.log("Error adding product")}catch(t){console.log("Error:",t)}})(t,_),b(),await o()}else{if(!(422===e.status||404===e.status||e.status>=500))throw new Error("Something went wrong...");{const t=(await e.json()).message;console.log(t)}}}catch(t){console.error("Error:",t),(t=>{const e=document.createElement("div");e.classList.add("modal"),e.setAttribute("id","errorModal");const n=document.createElement("div");n.classList.add("modal-content");const a=document.createElement("span");a.classList.add("close"),a.textContent="×";const o=document.createElement("h2");o.textContent="Error";const c=document.createElement("p");c.textContent=t,n.appendChild(a),n.appendChild(o),n.appendChild(c),e.appendChild(n),document.body.appendChild(e),e.style.display="block",a.addEventListener("click",(()=>{e.style.display="none"}))})("Something went wrong...")}})(n),b(),await o(),j.reset(),A()})),k.addEventListener("click",(t=>{const e=t.target;e.closest(".table__btn_del")&&(async(t,e)=>{const n=document.createElement("div");n.classList.add("overlay","active");const a=document.createElement("div");a.classList.add("overlay__modal","modal");const c=document.createElement("p");c.textContent="Are you sure you want to delete this product?";const d=document.createElement("button");d.textContent="Confirm",d.addEventListener("click",(async()=>{try{await fetch(`http://localhost:3000/api/goods/${t}`,{method:"DELETE"});const n=await C(),a=n.findIndex((e=>e.id==t));n.splice(a,1),e.closest(".row").remove(),console.log(n),b(n),await o()}catch(t){console.error("Failed to delete the product:",t)}n.remove()}));const l=document.createElement("button");l.textContent="Cancel",l.addEventListener("click",(()=>{n.remove()})),a.appendChild(n),n.appendChild(c),n.appendChild(d),n.appendChild(l),document.body.appendChild(n)})(e.closest("tr").dataset.id,e)})),S.addEventListener("click",(()=>{var t,e;E.classList.add("active"),L.textContent=(t=500,e=900,t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t)})),q.addEventListener("click",(t=>{const e=t.target;(e===q||e.closest(".modal__close"))&&A()})),F.forEach((t=>{t.required=!0})),F.forEach((t=>{const e=document.querySelector(".modal__total-price");e.textContent="0.00",t.addEventListener("blur",(()=>{e.value=a(T.value,$.value,I.value).toFixed(2)}))})),e(),k.addEventListener("click",(async t=>{const e=t.target;if(e.closest(".table__btn_pic")){const t=e.closest("tr").dataset.id;try{const e=await fetch(`http://localhost:3000/api/goods/${t}`);if(!e.ok)throw new Error("Image not found");const n=await e.json();console.log(n);const a=`http://localhost:3000/${n.image}`,o=screen.width/2-400,c=screen.height/2-300;window.open(a,"_blank",`width=800,height=600,left=${o},top=${c}`)}catch(t){console.error(t),window.alert(t.message)}}})),(async()=>{(await C()).forEach((t=>{const{id:e,title:n,price:a,category:o,count:c,units:d,discount:l,description:s,image:i}=t,r=h({id:e,title:n,price:a,category:o,count:c,units:d,discount:l,description:s,image:i});y.appendChild(r)})),b(),await o()})()}();